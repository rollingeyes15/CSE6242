	<!DOCTYPE html>
	<html lang="en">
		<title>vyamsani3</title>
	    <head>
	        <meta charset="utf-8">
	        <title>heatmap</title>
	        <script src="../lib/d3.v5.min.js"></script>
	        <style type="text/css">
				html { 
				      font-size: 62.5%; 
				    } 
				    
				    body {
				      margin-top: 30px;
				      font-size: 1.4rem;
				      font-family: 'Source Sans Pro', sans-serif;
				      font-weight: 400;
				      fill: #696969;
				      text-align: center;
				    }
				    
				    .xLabel, .yLabel {
						    font-size: 1.2rem;
						    fill: #AAAAAA;
						    font-weight: 300;
						    text-anchor: end;
						}

				    #nav-container {
				      display: flex;
				      justify-content: center;
				      cursor: pointer;
				    }

				    #nav-container .left {
				      margin-right: 20px;
				    }

				    #nav-container .right {
				      margin-left: 20px;
				    }
			
			</style>
	    </head>
		
		<body>
			<div id="nav-container">
			    <div class="nav left">Year</div>
			    <div id="locationDropdown"></div>
			    <!-- <div class="nav right">right</div> -->
			</div>
	<div id="heatmap"></div>
	        <script type="text/javascript">
	            // Your beautiful D3 code will go here

				var long_data = [];
	            var dataset = d3.csv("heatmap.csv")
	            	.then(function(row1) {

	            		row1.forEach(function(d) {
	            			d["Bronx"] = +d.Bronx,
	            			d.Brooklyn = +d.Brooklyn,
	            			d.Manhattan = +d.Manhattan,
	            			d.Queens = +d.Queens,
	            			d["Staten"]= +d["Staten Island"],
	            			d["Type"] = d["Crime Type"],
	            			d.Year = +d.Year

	            	})
	            		row1.forEach(function(row) {
	            			long_data.push( {"Type": row["Type"], "Borough": "Bronx", "Count": row["Bronx"], "Year": row["Year"]});
						    long_data.push( {"Type": row["Type"], "Borough": "Brooklyn", "Count": row["Brooklyn"], "Year": row["Year"]});
						    long_data.push( {"Type": row["Type"], "Borough": "Manhattan", "Count": row["Manhattan"], "Year": row["Year"]});
						    long_data.push( {"Type": row["Type"], "Borough": "Queens", "Count": row["Queens"], "Year": row["Year"]});
						    long_data.push( {"Type": row["Type"], "Borough": "Staten Island", "Count": row["Staten"], "Year": row["Year"]});
	            		})
	            		;

	            var l = long_data.length;
				var margin = {top: 50, right: 0, bottom: 100, left: 100},
	   			width = 400 - margin.left - margin.right,
	    		height = 400 - margin.top - margin.bottom;
	    		
	    		var color_gradations = 9;

	    		var colors = d3.schemeRdPu[color_gradations];

	    		var x = d3.scaleLinear().range([0, width]);
				var y = d3.scaleLinear().range([height, 0]);
				// var z = d3.scaleLinear().range(colors);
				var z = d3.scaleLinear();

				x.domain(d3.extent(long_data, function(d) { return d["Type"]; })).nice();
				y.domain(d3.extent(long_data, function(d) { return d["Borough"]; })).nice();
				z.domain([0, d3.max(long_data, function(d){return d["Count"];} )]);

		        var svg = d3.select("body").append("svg")
						    .attr("width", width + 2*margin.left + 2*margin.right)
						    .attr("height", height + 2*margin.top + 2*margin.bottom)
						    .append("g")
						    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
				var types = long_data.map(function(d) {return d.Type;}).sort().filter(function(item, pos, ary) {
											        return !pos || item != ary[pos - 1];
											    });

				var boroughs = long_data.map(function(d) {return d.Borough;}).sort().filter(function(item, pos, ary) {
											        return !pos || item != ary[pos - 1];
											    });

				var years = long_data.map(function(d) {return d.Year;}).sort().filter(function(item, pos, ary) {
								        return !pos || item != ary[pos - 1];
								    });

				var gridSize = Math.floor(width / types.length);

				var yLabels = svg.selectAll(".yLabel")
						          	.data(boroughs)
						        	.enter().append("text")
						            .text(function (d) { return d; })
						            .attr("x", 0)
						            .attr("y", function (d, i) { return i * gridSize; })
						            .attr("class", "yLabel")
						            .style("text-anchor", "end")
						            .attr("transform", "translate(-6," + gridSize / 1.5 + ")");

				var xLabels = svg.selectAll(".xLabel")
							        .data(types)
							        .enter().append("text")
								    .text(function(d) { return d; })
						            .attr("y", function(d, i) { return i * gridSize + gridSize/2; })
						            .attr("x", -(height + 6))
						            .attr("class", "xLabel")
						            .style("text-anchor", "end")
						            .attr("transform", "rotate(-90)")
						            ;

			    var locationMenu = d3.select("#locationDropdown");
			    
			    locationMenu.append("select")
					   		.attr("id", "locationMenu")
					    	.selectAll("option")
					        .data(years)
					        .enter()
					        .append("option")
					        .attr("value", function(d, i) { return i; })
					        .text(function(d) { return d; });

			    function getDataByYear(idx = 0) {
			    	var temp =  long_data
			    			.filter(function(d) {
						    		if (d.Year == years[idx]){ return d; }
						    	});
			    			return temp;
			    }

				function getMaxCount(year) {
					var idx = +year - years[0];
					var dataForCurrentYear = getDataByYear(idx);
					return d3.max(dataForCurrentYear, function(d) {
						return d.Count;
					});
				}

				var maxCountsArray = years.map(function(d, i){
					return getMaxCount(years[i]);
				});

				function getMaxCountInYear(year) {
					return maxCountsArray[+year - years[0]];
				}

				function colorScale(row) {
					var year = row.Year;
					var maxForCurrentYear = getMaxCountInYear(year);
					var scaled =  d3.scaleLinear()
								  	.domain(d3.range(0, maxForCurrentYear, 9))
								  	.range(colors);
				  	return scaled(row.Count);
				}

		      	function updateHeatMap(dataOfSelectedYear) {
		      		svg.selectAll(".tile")
				      .data(dataOfSelectedYear)
				    	.enter().append("rect")
				      .attr("class", "tile")
				      .attr("x", function(d, i) { return Math.floor(i/boroughs.length) * gridSize; })
				      .attr("y", function(d, i) { return (i % boroughs.length) * gridSize; })
				      .attr("class", "hour bordered")
				      .attr("width", gridSize)
				      .attr("height",  gridSize)
				      .style("stroke", "white")
				      .style("stroke-opacity", 0.6)
				      .style("fill", function(d) { return colorScale(d); });
		      	} 

		      	var defaultYearIndex = 0;
		      	var dataOfDefaultYear = getDataByYear(defaultYearIndex);
		      	updateHeatMap(dataOfDefaultYear);

			    locationMenu.on("change", function() {
			      		// find which year was selected from the dropdown
				      var selectedYearIndex = d3.select(this)
				        .select("select")
				        .property("value");

				      var dataByYear = getDataByYear(selectedYearIndex);

				      updateHeatMap(dataByYear);
				      
			    }); 

			    console.log(z);

			    var legend = svg.selectAll(".legend")
      				.data(z.ticks(9).slice(1).reverse())
				    .enter().append("g")
				    .attr("class", "legend")

  		var legendElementWidth = gridSize * types.length/color_gradations;

          legend.append("rect")
            .attr("x", function(d, i) { return legendElementWidth * i; })
            .attr("y", height + 80)
            .attr("width", legendElementWidth)
            .attr("height", gridSize / 3)
            .style("fill", function(d, i) { return colors[i]; })
            ;

		  legend.append("text")
	            .attr("x",function(d, i) { return legendElementWidth * (color_gradations - i - 1); })
	            .attr("y", height + 90 + gridSize/3)
	            .attr("dy", ".35em")
			    .text(String);

		  svg.append("text")
		      .attr("class", "label")
		      .attr("x", 0)
		      .attr("y", height + 70)
		      .attr("dy", ".35em")
		      .text("No. of crimes");

			    // var legend = svg.selectAll(".legend")
       //        		.data([0].concat(colorScale.quantiles()), function(d) { return d; });

       //    legend.enter().append("g")
       //        .attr("class", "legend");

       //    legend.append("rect")
       //      .attr("x", function(d, i) { return legendElementWidth * i; })
       //      .attr("y", height)
       //      .attr("width", legendElementWidth)
       //      .attr("height", gridSize / 2)
       //      .style("fill", function(d, i) { return colors[i]; });

       //    legend.append("text")
       //      .attr("class", "mono")
       //      .text(function(d) { return "â‰¥ " + Math.round(d); })
       //      .attr("x", function(d, i) { return legendElementWidth * i; })
       //      .attr("y", height + gridSize);

       //    legend.exit().remove();


		// var legendData = [["bad rating", "red", "circle"], ["good rating", "blue", "cross"]];

		// svg.selectAll('.symbol')
	 //     .data(legendData)
	 //     .enter()
	 //     .append('path')
	 //     .attr('transform', function(d, i) {
	 //       return 'translate(' + (width) + ',' + ((i * 20) + 10) + ')';
	 //     })
	 //     .attr('d', d3.symbol().type(function(d, i) {
	 //         if (d[2] === "circle") {
	 //           return d3.symbolCircle;
	 //         } else if (d[2] === "cross") {
	 //           return d3.symbolCross;
	 //         } 
	 //       })
	 //       .size(25))
	 //     .style("stroke", function(d) {
	 //       return d[1];
	 //     });

	 //   svg.selectAll('.label')
	 //     .data(legendData)
	 //     .enter()
	 //     .append('text')
	 //     .attr("x", width + 7.5)
	 //     .attr("y", function(d, i){ return ((i * 20) + 12.5);})
	 //     .text(function(d) {
	 //       return d[0];
	 //     });

	 //    // Add Title 
		// svg.append("text")
		// 	.attr("x", (width/2 - margin.right ))
		// 	.attr("y", 0)
		// 	// .attr("class", "label")
		// 	.attr("text-anchor", "middle")
		// 	.attr("font-family", "sans-serif")
		// 	.attr("font-size", "12px")
		// 	.attr("font-weight", "bold")
		// 	.text("Wins+Nominations vs. Rating");

		// // Add x-axis label
		// svg.append("text")
	 //      // .attr("class", "label")
	 //      .attr("x", width + margin.left - 5)
	 //      .attr("y", height )
	 //      .attr("font-size", "11px")
	 //      .attr("font-family", "sans-serif")
	 //      .style("text-anchor", "end")
	 //      .text("Rating");

	 //     // Add y-axis label
		// svg.append("text")
	 //      // .attr("class", "label")
	 //      .attr("x",  margin.left - 30)
	 //      .attr("y", margin.top - 12)
	 //      .attr("font-size", "11px")
	 //      .attr("font-family", "sans-serif")
	 //      .attr("transform", "rotate(-90)")
	 //      .style("text-anchor", "end")
	 //      .text("Wins+Noms");
	});
	        </script>
	    </body>
		
	</html>     